<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>[[${lectures.title}]]-TKB甄戰學習顧問中心</title>
<meta name="description" th:content="|${lectures.seo_content}|"/>
<meta name="keywords" content="TKB甄戰學習顧問中心"/>

<meta property="og:title" content="${lectures.title}-TKB甄戰學習顧問中心"/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="${BASE_PATH}lectures/inside?str=${str}"/>
<meta property="og:image" content="${lectures.image}"/>
<meta property="og:site_name" content="TKB甄戰學習顧問中心" />
<meta property="og:description" content="${lectures.seo_content}" />

<link rel="shortcut icon" type="image/x-icon" th:href="${@environment.getProperty('static.url')}+@{/images/front/favicon1.ico}" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<link rel="stylesheet" type="text/css" th:href="${@environment.getProperty('static.url')}+@{/css/front/front_style.css}" />	<!-- 電腦版 -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
<!-- 20190625 start -->
<link rel="stylesheet" type="text/css" th:href="${@environment.getProperty('static.url')}+@{/css/front/font-awesome.css}" />
<link type="text/css" rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous" />
<link type="text/css" rel="stylesheet" th:href="${@environment.getProperty('static.url')}+@{/css/front/jquery.mCustomScrollbar.css}" />
<!-- 20190625 end -->
<link th:insert="~{front/loadForOldPage/js :: common}">
<script th:src="${@environment.getProperty('static.url')}+@{/js/baseUtil.js}"></script>
<script th:src="${@environment.getProperty('static.url')}+@{/js/baseForm.js}"></script>
<!-- Global site tag (gtag.js) - Google Ads: 957644279 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=AW-957644279"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'AW-957644279');
</script>
</head>
<body>

<!-- 行動版 -->
<div th:insert="~{front/loadForOldPage/layout :: menu_rwd}"></div>
<div class="wrapper">
	<!-- 20190625 start -->
	<div class="header-box">  
		<div th:insert="~{front/loadForOldPage/layout :: header}"></div>
		
		<div th:insert="~{front/loadForOldPage/layout :: menu}"></div>
	</div>
	<div class="content">
		<div class="ad">
		
		
		
		<th:block th:if="${#lists.size(navBannerList)==3}">
			<th:block th:each="dataStatus , data : ${navBannerList}">
				<th:block th:if="${data.count == 1}">
				<div><a th:href="${dataStatus.link}" th:onclick="|banner_toInside('${dataStatus.id}')|" target="_blank"><img th:src="${@environment.getProperty('static.url')}+@{/upload/image/navBanner/{image}(image=${dataStatus.image})}"></a></div>
				</th:block>
			<th:block th:if="${data.count == 2}">
				<div><a th:href="${dataStatus.link}" th:onclick="|banner_toInside('${dataStatus.id}')|" target="_blank"><img th:src="${@environment.getProperty('static.url')}+@{/upload/image/navBanner/{image}(image=${dataStatus.image})}"></a></div>
				</th:block>
			</th:block>
		</th:block>
		<th:block th:if="${#lists.size(navBannerList)<3}">
			<th:block th:each="dataStatus , data : ${navBannerList}">
				<div><a th:href="${dataStatus.link}" target="_blank"><img th:src="${@environment.getProperty('static.url')}+@{/image/navBanner/{image}(image=${dataStatus.image})}"></a></div>
			</th:block>
		</th:block>
		
		
		
		<th:block th:if="${#lists.size(navBannerList)==3}">
			<th:block th:each="dataStatus , data : ${navBannerList}">
				<th:block th:if="${data.count == 3}">
				<div><a th:href="${dataStatus.link}" th:onclick="|banner_toInside('${dataStatus.id}')|" target="_blank"><img th:src="${@environment.getProperty('static.url')}+@{/upload/image/navBanner/{image}(image=${dataStatus.image})}"></a></div>
				</th:block>
			</th:block>
		</th:block>
		
		
		
		<div class="metaBox"></div>
		
		
		<th:block th:each="dataStatus , data : ${navBannerType2List}">
			<div><a th:href="${dataStatus.link}" th:onclick="|banner_toInside('${dataStatus.id}')|" target="_blank"><img th:src="${@environment.getProperty('static.url')}+@{/images/navBanner/{image}(image=${dataStatus.image})}"></a></div>
		</th:block>
		</div>
		<!--             ad -->
		<div class="main_area">

		<form id="getForm" method="GET" enctype="multipart/form-data">
			<input type="hidden" id="str" name="str"/>
		</form>
		<th:block th:with="fare_name = ${lectures.fare} == 1 ? '免費': '付費'">
		<div class="main-area-title">近期活動</div>
		<div class="back"><a th:href="@{/lectures/index}">回上頁</a></div>
		<hr />
		<h1 class="article-title" th:utext="${lectures.title}"></h1>
		<div class="community_API"><a th:href="'javascript:void window.open('+@{'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent('https://www.daso.com.tw/lectures/inside?str={str}')(str=${shareStr})}+')'"><img th:src="${@environment.getProperty('static.url')}+@{/images/front/fb_api.png}"></a></div>
		<div class="viewers">[[${lectures.click_rate}]]</div>
		<div class="release" th:text="發佈時間：+${#dates.format(begin_date, 'yyyy/MM/dd')}"></div>
		<div class="update" th:text="更新時間：+${#dates.format(update_date, 'yyyy/MM/dd')}"></div>
		<div class="poster"><img th:src="${lectures.image}" /></div>
		<h1 class="lecture_title" th:utext="${lectures.title}"></h1>

        <div class="apply"><a href="#LR">報名講座&nbsp;&nbsp;&nbsp;&gt;</a></div>

        <hr />
		<th:block th:each="dataStatus , data : ${lecturesContentList}">
			<h2 th:class="${#strings.substring(dataStatus.icon,0,14)}">[[${dataStatus.title}]]</h2>
			<div class="article" th:utext="${#strings.replace(dataStatus.content,'&#10;','&lt;br&gt;')}"></div>
<!-- 		<div class="article" th:utext="${#strings.replace(dataStatus.content,'&#10;','&lt;br&gt;')}"></div> -->
<!-- 		&nbsp -->
		</th:block>
		<hr />
		<div class="lecture_area">
        	<div class="lecture_info">
            	<dl>
                	<dt>講座地點</dt><th:block th:each="dataStatus , data : ${lecturesPlaceList}"><th:block th:if="${dataStatus.placeName == '全省甄戰'}"><input type="hidden" id="allPlace" value="1" /></th:block><th:block th:if="${data.count != 1}"><dt style="background: url(/images/front/space.png) 0 20px no-repeat;">&nbsp;</dt></th:block><dd>【[[${dataStatus.placeEvent}]]】[[${dataStatus.placeName}]] <span style="color: #666;" th:utext="${#strings.substring(dataStatus.placeDay,0,10)}"></span><span style="color: #666;" th:utext="${#strings.substring(dataStatus.placeDay,11,16)}"></span></dd></th:block>
                	<dt>講座費用</dt><dd>[[${fare_name}]]<th:block th:if="${lectures.fare} == 2"> [[${lectures.fare_money}]]</th:block></dd>
                	<dt>講座類別</dt><dd>[[${lecturesCategory.name}]]</dd>
                </dl>
            </div><!-- lecture_info -->
            <div class="lecture_site">
           			<div style="text-align: center;">
           			<span style="font-size:1.2rem;line-height:2rem;margin:0 ;">查詢講座地點:</span>
           			<span class="List1">
           			<select style="font-size:1rem;" name="lecturesReceive.place" id="areaMap" th:onchange="|changeLocationMap()|">
           			<option value="0">請選擇</option>
             			<th:block th:each="dataStatus , data : ${locationList}">
                       	 <option th:value="${dataStatus.name}">[[${dataStatus.name}]]-[[${dataStatus.address}]]</option>
						</th:block>
					</select>
					</span>
					<span class="List2">
					<select style="font-size:1rem;" name="lecturesReceive.place" id="placeMap" th:onchange="|changePlaceMap()|">
           			<option value="0">請選擇</option>
           				<th:block th:each="dataStatus , data : ${placeList}">
                 	       <option th:value="${dataStatus.placeName}">[[${dataStatus.placeName}]]-[[${dataStatus.place_address}]]</option>
						</th:block>
					</select>
					</span>
           			</div>
           		<div id="toPlaceMap"></div>
            </div><!-- lecture_site -->
        </div><!-- lecture_area -->
		</th:block>
		</div><!-- main_area -->
		<div class="clear_float"></div>

           <hr />
           <div class="red_word" id="LR">如欲參加本講座，歡迎填表洽詢，將有專人為您服務 *必填</div>
           <form id="ReceiveForm" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="lecturesReceive.project_name" th:value="${lectures.title}" />
            <input type="hidden" id="lectures_id" name="lectures.id" th:value="${lectures.id}" />
            <input type="hidden" id="lecture_type_id"  th:value="${lectures.lecture_type_id}" />
			<input type="hidden" id="print_id" name="print_id" value="3323" /><!-- PO版人 -->
            <input type="hidden" name="loginEquipment" th:value="${login_equipment}"/><!-- 登入裝置 -->
            <input type="hidden" id="keyword" value="<%=keyword%>"/><!-- google廣告參數 -->
			<input type="hidden" id="network" value="<%=network%>"/><!-- google廣告參數 -->
			<input type="hidden" id="device" value="<%=device%>"/><!-- google廣告參數 -->
			<input type="hidden" id="campaignid" value="<%=campaignid%>"/><!-- google廣告參數 -->
			<input type="hidden" id="is_google_ad" value="<%=is_google_ad%>"/><!-- google廣告參數 -->
            <input type="hidden" id="lecturesReceivePlace" name="lecturesReceive.place" />
            <table>
                <tr>
                <th width="20%">真實姓名<span>*</span></th>
                <td><input type="text" name="lecturesReceive.name" id="name" maxlength="6"/></td>
                </tr>
                <tr>
                <th>行動電話<span>*</span></th>
                <td><input type="tel" name="lecturesReceive.cellphone" id="cellphone" maxlength="10"/></td>
                </tr>
                <tr>
                <th>電子郵件<span>*</span></th>
                <td><input type="email" name="lecturesReceive.mail1" id="email" maxlength="30" /></td>
                </tr>
                <tr>
                <th>參加地點與時間<span>*</span></th>
                <td>參加地點：
                
                <span class="List1">
           			<select id="toArea" th:onchange="|changeArea('全省甄戰')|">
           			<option value="0">請選擇</option>
             			<th:block th:each="dataStatus , data : ${locationList}">
                       	 <option th:value="${dataStatus.area_id}">[[${dataStatus.name}]]</option>
                       	 
						</th:block>
					</select>
                </span>
                <span class="List2">
                    <select id="toPlace" th:onchange="|changePlace()|">
                    <option value="0">請選擇</option>
                	<th:block th:each="dataStatus , data : ${placeList}">
                        <option th:value="${dataStatus.placeName}">[[${dataStatus.placeName}]]</option>
					</th:block>
					</select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span>
                  	  參加場次：
					<select id="toEvent" name="lecturesReceive.showings">
					</select>
                </td>
                </tr>
                <tr>
                <th>可聯絡時間<span>*</span></th>
                <td>
                    <select id="take" name="lecturesReceive.take">
                    	<option value="0">皆可</option>
						<option value="1">早上</option>
						<option value="2">中午</option>
						<option value="3">下午</option>
						<option value="4">晚上</option>
                    </select>
                </td>
                </tr>
                <tr>
                <th>是否寄送電子報<span>*</span></th>
                <td>
                	<input type="radio"  name="sale_agree" value="1"/>是
                	<input type="radio"  name="sale_agree" value="0"/>否
                </td>
                </tr>
<!--                 <tr> -->
<!--                <th> -->
<!--                目前背景 -->
<!--                </th> -->
<!--                <td id="backgroundTd"> -->
<!--                	<select id="backgroundSelect" onchange="backgroundSearch(this.options[this.options.selectedIndex].value)"> -->
<!--                		<option value="0">--在校/在職--</option> -->
<!--                		<option value="1">在校</option> -->
<!--                		<option value="2">在職</option> -->
<!--                	</select> -->
<!-- 				<select id="areaSelect" onchange="schoolSearch()"> -->
<!-- 					<option value="0">--區域--</option> -->
<!-- 				</select> -->
<!-- 				<select id="degreeSelect" onchange="schoolSearch()"> -->
<!-- 					<option value="0">--學制--</option> -->
<!-- 				</select> -->
<!-- 				<select id="schoolSelect"> -->
<!-- 					<option value="0">--就讀學校--</option> -->
<!-- 				</select>					 -->
<!-- 				<select id="workBackgroundSelect"> -->
<!-- 					<option value="0">--背景--</option> -->
<!-- 					<option value="1">電類</option> -->
<!-- 					<option value="3">資訊類</option>	 -->
<!-- 					<option value="4">機械類</option>					 -->
<!-- 					<option value="5">土木類</option> -->
<!-- 					<option value="6">環工類</option> -->
<!-- 					<option value="7">化工類</option> -->
<!-- 					<option value="8">語言類</option> -->
<!-- 					<option value="9">商管類</option> -->
<!-- 					<option value="10">行政類</option> -->
<!-- 				</select> -->
<!--                </td> -->
<!--                </tr> -->

<!--                 <tr> -->
<!--                 <th>備註描述</th> -->
<!--                 <td><textarea name="ps" cols="" rows=""></textarea></td> -->
<!--                 </tr> -->
                
                <tr>
                <th>備註描述<br/>
                (例如，就讀學校)
                </th>
                <td>
                <textarea name="ps" cols="" rows=""></textarea>
                <p><br />註：同學若有預約試聽或課程諮詢等需求，均可留言，我們會儘快與您聯絡。</p>
                </td>
                </tr>
                
                
            </table>
<!--             <input id="sale_agree" checked type="checkbox" />我想收到最新考試資訊及課程優惠電子報<br> -->
            <input name="lecturesReceive.sale_agree" id="is_read" type="checkbox" />請勾選已詳細閱讀及了解本站之<a th:href="@{/common/personLaw}" target="_blank"><span><u>個資法及隱私權相關規範</u></span></a>。
            <div class="send"><a th:onclick="|toReceiveEC(${lectures.id})|" style="cursor:pointer;">送出資料</a></div>
		</form>
	</div><!--             content -->
</div><!--             wrapper -->
		<div th:insert="~{front/loadForOldPage/layout :: footer}"></div>	
	    <script th:src="${@environment.getProperty('static.url')}+@{/js/facebook_Adjust.js}"></script>
	    <script th:src="${@environment.getProperty('static.url')}+@{/js/front/advertising.js}"></script>
<script>

//var toUrl = location.href;

$(function(){
	if($("#allPlace").val() == '1'){
		$(".List2").hide();
	}else{
		$(".List1").hide();
	}
	
// 	toGetLocationList();	
// 	getSchoolArea();

// 	$("#backgroundTd select").hide();
// 	$("#backgroundSelect").show();
	
	changePlace = function() {
		$.ajax({
			url: "[[${@environment.getProperty('weburl')}]]/lectures/changePlace",
			cache: false,
			async: false,
			dataType: "json",
			type:"POST",
			data:{
				lectures_id : $("#lectures_id").val(),
				place : $('#toPlace option:selected').text()
			},
			error: function(xhr) {
				alert('Ajax request 發生錯誤');
			},
			success: function(data) {
				
				$("#toEvent").empty();
				if($("#toPlace").val() == 0) {
					displayControl($("#toEvent"), "hide");
				} else {
					displayControl($("#toEvent"), "show");
				}
				if(data != null && data.length > 0){
					$("#toEvent").append("<option value='0'>請選擇</option>");
					for(i = 0 ; i < data.length; i++){
						var event = data[i];
							$("#toEvent").append("<option value='" + event.placeDay.substring(0,19) + "'>【" + event.placeEvent +"】" + event.placeDay.substring(0,16)  + "</option>");
					}
				}
			}
		});

	},

	changeArea = function(area) {

		$.ajax({
			url: "[[${@environment.getProperty('weburl')}]]/lectures/changePlace",
			cache: false,
			async: false,
			dataType: "json",
			type:"POST",
			data:{
				lectures_id : $("#lectures_id").val(),
				place : area
			},
			error: function(xhr) {
				alert('Ajax request 發生錯誤');
			},
			success: function(data) {

				$("#toEvent").empty();
				if($("#toArea").val() == 0) {
					displayControl($("#toEvent"), "hide");
				} else {
					displayControl($("#toEvent"), "show");
				}
				if(data != null && data.length > 0){
					$("#toEvent").append("<option value='0'>請選擇</option>");
					for(i = 0 ; i < data.length; i++){
						var event = data[i];
							$("#toEvent").append("<option value='" + event.placeDay.substring(0,19) + "'>【" + event.placeEvent +"】" + event.placeDay.substring(0,16)  + "</option>");
					}
				}
			}
		});

	},

	changePlaceMap = function() {
		$.ajax({
			url: "[[${@environment.getProperty('weburl')}]]/lectures/changePlaceMap",
			cache: false,
			async: false,
			dataType: "json",
			type:"POST",
			data:{
				placeMap : $("#placeMap").val()
			},
			error: function(xhr) {
				alert('Ajax request 發生錯誤');
			},
			success: function(data) {
				$("#toPlaceMap").empty();
				if(data != null && data.length > 0){
					var map = data[0];
					$("#toPlaceMap").append("<iframe width='100%' height='220' frameborder='0' scrolling='no' marginheight='0' marginwidth='0' src="+map.url+"></iframe>");
				}
			}
		});

	},

	changeLocationMap = function() {

		$.ajax({
			url: "[[${@environment.getProperty('weburl')}]]/lectures/changePlaceMap",
			cache: false,
			async: false,
			dataType: "json",
			type:"POST",
			data:{
				placeMap : $("#areaMap").val()
			},
			error: function(xhr) {
				alert('Ajax request 發生錯誤');
			},
			success: function(data) {
				$("#toPlaceMap").empty();
				if(data != null && data.length > 0){
					var map = data[0];
					$("#toPlaceMap").append("<iframe width='100%' height='220' frameborder='0' scrolling='no' marginheight='0' marginwidth='0' src="+map.url+"></iframe>");
				}
			}
		});

	},
	
	banner_toInside = function(id) {
		
		$.ajax({
			url: "[[${@environment.getProperty('weburl')}]]/navBannerUpdateClickRate",
			cache: false,
			async: false,
			type:"POST",
			data:{
				id : id
			},
			success: function(data) {
				
			}
		});
		
	}

});

function toReceiveEC(id){
	let currentURL = new URLSearchParams(document.location.search);
	var strValue = currentURL.get('print_id');

	var phonecheck = /^[09]{2}[0-9]{8}$/;//檢查手機正則表達式

	if(strValue==null){
		strValue=$("input[name='print_id']").val()
	}

	if($("#name").val() == "") {
		alert("請輸入姓名");
		return false;
	}

	if($("#cellphone").val() == "") {
		alert("請輸入行動電話");
		return false;
	}

	if(!phonecheck.test($("#cellphone").val())){
		alert("請輸入正確的行動電話");
		return false;
	}

	if($("#email").val() == "") {
		alert("請輸入電子郵件");
		return false;
	}
	if(!isEmail($("#email").val())){
		alert("不是正確的信箱格式");
		return false;
	}

	if($("#toArea").val() == 0 && $("#allPlace").val() == '1') {
		alert("請選擇講座地區");
		return false;
	}

	if($("#toPlace").val() == 0 && $("#allPlace").val() != '1') {
		alert("請選擇講座地區");
		return false;
	}

	if($("#toEvent").val() == 0) {
		alert("請選擇講座場次");
		return false;
	}
	
	if($("input[name='sale_agree']:checked").val() != 1 && $("input[name='sale_agree']:checked").val() != 0){
		alert("請勾選是否寄送電子報");
		return false;
	}

	if(!$("#is_read").prop("checked")){
		alert("請勾選已詳細閱讀及了解本站之個資法相關規範");
		return false;
	}
	
// 	var saleAgree = '1';
// 	if ($("#sale_agree").prop("checked", true)) {
// 		saleAgree = '1';
// 	} else {
// 		saleAgree = '0';
// 	}
	
	if($("#allPlace").val() == '1'){
		$("#lecturesReceivePlace").val($("#toArea").val());
	}else{
		$("#lecturesReceivePlace").val($("#toPlace").val());
	}
	$(".send a").attr("disabled",true);
	$(".send a").css("pointer-events","none");
	var json = {};
	var childname = $("#name").val();
	var phone = $("#cellphone").val();
	var email = $("#email").val();
	var webLocationId = $("#lecturesReceivePlace").val();
	var contactTime = $("#take").val();
	var event = $("#toEvent").val();
	var printId = strValue;
	var loginEquipment = $("input[name='loginEquipment']").val();
	var typeId = $("#lecture_type_id").val();
	var saleAgree = $("input[name='sale_agree']:checked").val();
	var time = new Date();
	var create_time = DateFormat(time, 'yyyy-MM-dd HH:mm:ss');
	var keyword = $("input[name='keyword']").val();
	var network = $("input[name='network']").val();
	var device = $("input[name='device']").val();
	var campaignid = $("input[name='campaignid']").val();
	var isGoogleAd = $("input[name='is_google_ad']").val();
	
	var backgroundDetail = "";
	var areaSelect = $("#areaSelect").find(":selected").val() == 0 ? "" : $("#areaSelect").find(":selected").text();
	var schoolSelect = $("#schoolSelect").find(":selected").val() == 0 ? "" : $("#schoolSelect").find(":selected").text();
	var workBackgroundSelect = $("#workBackgroundSelect").find(":selected").val() == 0 ? "" : " 背景類別為"+$("#workBackgroundSelect").find(":selected").text();
	
	var memo = $("textarea[name='ps']").val();
	if(memo != ""){
		memo += ", 講座來源名稱："+$("input[name='lecturesReceive.project_name']").val()+",";
	}else{
		memo += "講座來源名稱："+$("input[name='lecturesReceive.project_name']").val()+",";
	}
	
// 	if($("#backgroundSelect").find(":selected").val() == 1){
// 		backgroundDetail += "  目前"+$("#backgroundSelect").find(":selected").text();
// 		if(areaSelect != "" || schoolSelect != ""){
// 			backgroundDetail+=  " 就讀於"+areaSelect
// 			                +  schoolSelect
//                             +  workBackgroundSelect;
// 		}else{
// 			backgroundDetail += workBackgroundSelect;
// 		}
// 	}
// 	if($("#backgroundSelect").find(":selected").val() == 2){
// 		backgroundDetail += "  目前"+$("#backgroundSelect").find(":selected").text()
// 						 + workBackgroundSelect;
// 	}
// 	memo += backgroundDetail;
	
	json.NAME = childname;
	json.PHONE = phone;
	json.E_MAIL = email;
// 	json.WEB_LOCATION_ID = webLocationId;
	json.WEB_LOCATION_ID = '4';
	json.CREATE_DATE = create_time;
	json.CONTACT_TIME = contactTime;
	json.SALE_AGREE = saleAgree;
	json.MEMO = memo;
	json.LECTURE_SESSION_DATETIME = event;
	json.PRINT_ID = printId;
	json.IS_READ = '1';
	json.LOGIN_EQUIPMENT = loginEquipment;
	json.IS_DEL = '0';
	json.ANATOMIC = 'R';
	json.TYPE_ID = typeId;
	json.TYPE_CODE = "LECTURE";
	json.IS_IMPORT = '0';
	json.IS_POST_EC = '0';
	var data = JSON.stringify(json);
	var data2 = DES_Encrypt(data);
	
	$.ajax({
		url : "https://www.tkbtv.com.tw/api/formList/import",
		cache : false,
		async : true,
		dataType : "text",
		type : "POST",
		data : data2,
		error: function(err, tst, xhr) {
			   alert(JSON.stringify(err.responseText));
			   alert('送單異常');
		},
		success: function(data) {
			window.location.assign("/common/sendFormSuccess.html");
		}
	});

}
//RFC822 正規則
function isEmail(email){
	return /^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/.test( email );
}


//取得參加地點
function toGetLocationList(){
	var json = {};
	json.WEB = 'R';
	var data = JSON.stringify(json);
	var data2 = DES_Encrypt(data);
	
	$.ajax({
		url : "https://www.tkbtv.com.tw/api/webLocation/queryListByWeb",
		cache: false,
		async: true,
		dataType: "text",
		type:"POST",
		data : data2,
		error: function(xhr) {
			alert('取得全部參加地點失敗');
		},
		success : function(data) {
			$.ajax({
				url: "[[${@environment.getProperty('weburl')}]]/toGetLocation",
				cache: false,
				async: false,
				dataType: "json",
				type:"POST",
				data:{
					id : $("#lectures_id").val()
				},
				error: function(xhr) {
					alert('取得講座參加地點失敗');
				},
				success: function(data2) {
					if (data != null && data.length > 0 && data2[0].placename=="全省甄戰") {
						var str = "<option value='0'>請選擇</option>";
						var result = JSON.parse(data);
						var resultArray = result.data.WEB_LOCATION_LIST;
						$("#toPlace").empty();
						for(i = 0 ; i<resultArray.length ; i++){
							var location = resultArray[i];
							
							str += "<option value='"+location.WEB_LOCATION_ID+"'>"+location.LOCATION+"</option>";
						}
					    $("#toPlace").append(str);
						}
					else if (data != null && data.length > 0 && data2[0].placename != "全省甄戰") {
					    var str = "<option value='0'>請選擇</option>";
					    var result = JSON.parse(data);
					    var resultArray = result.data.WEB_LOCATION_LIST;
					    $("#toPlace").empty();
					    
					    // 比對 data2[n].placename 和 resultArray 中的 LOCATION
					    for(i = 0; i < data2.length; i++){
						    for (j = 0; j < resultArray.length; j++) {
						    	
						        var location = resultArray[j];
						        if (data2[i].placename.substring(0,2) === location.LOCATION.substring(0,2)) {
						            str += "<option value='" + location.WEB_LOCATION_ID + "'>" + location.LOCATION + "</option>";
						        }
						        
						    }

					    }
					    $("#toPlace").append(str);
					}

					else {
						alert('取得參加地點失敗');
					}
				}
			});
		}
	});
}

function DateFormat(date, format) {
	const year = date.getFullYear();
	const month = date.getMonth() + 1;
	const day = date.getDate();
	const hour = date.getHours();
	const minute = date.getMinutes();
	const second = date.getSeconds();
	const map = {
		'yyyy': year,
		'MM': String(month).padStart(2, '0'),
		'dd': String(day).padStart(2, '0'),
		'HH': String(hour).padStart(2, '0'),
		'mm': String(minute).padStart(2, '0'),
		'ss': String(second).padStart(2, '0')
	};
	return format.replace(/yyyy|MM|dd|HH|mm|ss/g, match => map[match]);
}
function getSchoolArea(){
	//進入edm頁面取得學校資料的下拉式選單
	$.ajax({
		url: "[[${@environment.getProperty('weburl')}]]/getSchoolArea",
		cache: false,
		async: false,
		dataType: "json",
		type:"POST",
		data:{},
		error: function(xhr) {
			alert('Ajax request 發生錯誤');
		},
		success: function(data) {
			var appendStr="";
			$.each(data[0], function(i, item){
				appendStr += "<option value='"+item.code+"'>"+item.description+"</option>"
			});
			$("#areaSelect").append(appendStr);
			appendStr = "";
			
			$.each(data[1], function(i, item){
				appendStr += "<option value='"+item.code+"'>"+item.description+"</option>"
			});
			$("#degreeSelect").append(appendStr);
			appendStr = "";
			
			$.each(data[2], function(i, item){
				appendStr += "<option value='"+item.school_no+"'>"+item.chinese_name+"</option>"
			});
			$("#schoolSelect").append(appendStr);
			
		}
	});
}
function schoolSearch(){
	$.ajax({
		url: "[[${@environment.getProperty('weburl')}]]/searchSchool",
		cache: false,
		async: false,
		dataType: "json",
		type:"POST",
		data:{
			degree : $("#degreeSelect").val(),
			area : $("#areaSelect").val(),
			school_category : $("#schoolCategorySelect").val()
		},
		error: function(xhr) {
			alert('Ajax request 發生錯誤');
		},
		success: function(data) {
			var str = "";
			if(data != null && data.length > 0){
				
				$("#schoolSelect").empty();
				str += "<option value='0'>--就讀學校--</option>";
				for(i = 0 ; i < data.length; i++){
					var schoolArray = data[i];
					str += "<option value='"+schoolArray.school_no+"'>"+schoolArray.chinese_name+"</option>";
				}
				$("#schoolSelect").append(str);
			}else{
				alert("查無此資料");
				$("#schoolSelect").empty();
				$("#schoolSelect").append("<option value='0'>--就讀學校--</option>");
			}
		}
	});
}
backgroundSearch = function(num){
	if(num== 1){
		$("#backgroundTd select").show();
		$('#backgroundTd select').prop('selectedIndex',0);
		$("#backgroundSelect").val(num);
	}
	
	else if(num == 2){
		$("#backgroundTd select").hide();
		$("#backgroundSelect").show();
		$("#workBackgroundSelect").show();
		$('#backgroundTd select').prop('selectedIndex',0);
		$("#backgroundSelect").val(num);
	}
	else{
		$("#backgroundTd select").hide();
		$('#backgroundTd select').prop('selectedIndex',0);
		$("#backgroundSelect").show();
	}
}
</script>
</body>
</html>